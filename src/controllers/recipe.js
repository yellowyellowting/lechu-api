// 流行元素数据信息
exports.pop = function (req, res) {
    const result = [
        {
            "id": "103708663",
            "name": "椰奶吐司",
            "thumbnail": "http://i1.chuimg.com/349e8bfc5cf3424681b5cba84f7b92e6_1080w_864h.jpg@2o_50sh_1pr_1l_660w_90q_1wh",
            "cookId": "112064570",
            "cookName": "李果然",
            "stats": "1806 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "http://img3.imgtn.bdimg.com/it/u=226260387,2736876846&fm=26&gp=0.jpg",
                "img2": "http://img0.imgtn.bdimg.com/it/u=3520500708,2924643808&fm=26&gp=0.jpg",
                "img3": "http://img4.imgtn.bdimg.com/it/u=1441563553,739383591&fm=26&gp=0.jpg"
            },
            "title": "#正儿八经的做个蛋糕#",
            "des": "每年总要吃几次蛋糕啊！",
            "zp": {
                "photo": "http://img4.imgtn.bdimg.com/it/u=3188610320,3791162340&fm=26&gp=0.jpg",
                "username": '悦己2016',
                "watchNum": '123',
                "menu": '46',
                "zpNum": '234'
            }
        },
        {
            "id": "103708642",
            "name": "香烤鸡翅",
            "thumbnail": "https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=3299300486,3781703317&fm=26&gp=0.jpg",
            "cookId": "120967814",
            "cookName": "博世家电",
            "stats": "11 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "http://img3.imgtn.bdimg.com/it/u=1199266336,1249216877&fm=26&gp=0.jpg",
                "img2": "http://img5.imgtn.bdimg.com/it/u=4079866678,4140148883&fm=26&gp=0.jpg",
                "img3": "http://img4.imgtn.bdimg.com/it/u=3938657738,1158814296&fm=26&gp=0.jpg"
            },
            "title": "#面包儿进行曲#",
            "des": "喜欢吃粗娘的孩纸 肿么可以不会做面包呢~~",
            "zp": {
                "photo": "http://img5.imgtn.bdimg.com/it/u=2470461076,2763675581&fm=26&gp=0.jpg",
                "username": '风清扬',
                "watchNum": '263',
                "menu": '15',
                "zpNum": '23'
            }
        },
        {
            "id": "103708643",
            "name": "平菇青椒炒鸡蛋 好吃又营养的超快手家常菜",
            "thumbnail": "http://img2.imgtn.bdimg.com/it/u=584721423,94481501&fm=26&gp=0.jpg",
            "cookId": "122079365",
            "cookName": "千寻树",
            "stats": "252 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "http://img1.imgtn.bdimg.com/it/u=448197963,3166186660&fm=26&gp=0.jpg",
                "img2": "http://img0.imgtn.bdimg.com/it/u=1045795205,1202832319&fm=26&gp=0.jpg",
                "img3": "http://img4.imgtn.bdimg.com/it/u=2322918504,2630750078&fm=26&gp=0.jpg"
            },
            "title": "#花生家不定性早餐抽风日常#",
            "des": "我随行做，你随性看。",
            "zp": {
                "photo": "http://img2.imgtn.bdimg.com/it/u=1032554322,2365198028&fm=26&gp=0.jpg",
                "username": '精灵鬼',
                "watchNum": '1333',
                "menu": '35',
                "zpNum": '167'
            }
        },
        {
            "id": "103708644",
            "name": "盘丝饼",
            "thumbnail": "http://i1.chuimg.com/af2a802a87e811e6a9a10242ac110002_800w_533h.jpg@2o_50sh_1pr_1l_660w_90q_1wh",
            "cookId": "101553997",
            "cookName": "食肆巷子",
            "stats": "845 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "http://img4.imgtn.bdimg.com/it/u=1273224689,2371206209&fm=26&gp=0.jpg",
                "img2": "http://img5.imgtn.bdimg.com/it/u=2201000048,2072581305&fm=26&gp=0.jpg",
                "img3": "http://img4.imgtn.bdimg.com/it/u=1237495859,500366279&fm=26&gp=0.jpg"
            },
            "title": "#春天的滋味#",
            "des": "从南到北，春天急急地赶路，到华北，已是稍纵即逝，",
            "zp": {
                "photo": "http://img4.imgtn.bdimg.com/it/u=3638963425,188168073&fm=26&gp=0.jpg",
                "username": '伊人丁丁',
                "watchNum": '2793',
                "menu": '57',
                "zpNum": '7'
            }
        },
        {
            "id": "103708661",
            "name": "《Tinrry＋》Tinrry教你做分蛋海绵蛋糕",
            "thumbnail": "https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=788383578,3849208384&fm=26&gp=0.jpg",
            "cookId": "107144295",
            "cookName": "o橙小橙o",
            "stats": "179 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "http://img2.imgtn.bdimg.com/it/u=1289048170,2653536088&fm=26&gp=0.jpg",
                "img2": "http://img1.imgtn.bdimg.com/it/u=2095182176,586587647&fm=26&gp=0.jpg",
                "img3": "http://img1.imgtn.bdimg.com/it/u=3262616829,1270339376&fm=26&gp=0.jpg"
            },
            "title": "#时间知道#",
            "des": "是日，远远分享",
            "zp": {
                "photo": "http://img1.imgtn.bdimg.com/it/u=233997121,1829103342&fm=26&gp=0.jpg",
                "username": 'TC一TanChi',
                "watchNum": '3990',
                "menu": '2',
                "zpNum": '1802'
            }
        },
        {
            "id": "103708646",
            "name": "饭店必点的干锅花菜，是这么做出来的。",
            "thumbnail": "http://i2.chuimg.com/cca1ae7a229411e7bc9d0242ac110002_3264w_2448h.jpg?imageView2/2/w/660/interlace/1/q/90",
            "cookId": "100351317",
            "cookName": "小美的美食",
            "stats": "314 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事",
            "zp": {
                "photo": "http://img0.imgtn.bdimg.com/it/u=3293635140,3955114282&fm=26&gp=0.jpg",
                "username": '桃乐丝527',
                "watchNum": '3990',
                "menu": '10',
                "zpNum": '2802'
            }
        },
        {
            "id": "103708660",
            "name": "超级好吃的懒人榴莲酥",
            "thumbnail": "http://i2.chuimg.com/662ce02a8ad611e6b87c0242ac110003_1536w_2048h.jpg?imageView2/2/w/660/interlace/1/q/90",
            "cookId": "10666666",
            "cookName": "阿May又改名儿了",
            "stats": "508 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事",
            "zp": {
                "photo": "http://img1.imgtn.bdimg.com/it/u=3773645940,3042793859&fm=26&gp=0.jpg",
                "username": '仙Reese',
                "watchNum": '10990',
                "menu": '67',
                "zpNum": '809'
            }
        },
        {
            "id": "103708655",
            "name": "新晋网红【杏花楼 咸蛋黄肉松青团】",
            "thumbnail": "http://i2.chuimg.com/28c1c0228a9d11e6a9a10242ac110002_1000w_667h.jpg?imageView2/2/w/660/interlace/1/q/90",
            "cookId": "10585157",
            "cookName": "啊呜511",
            "stats": "42 做过",
            "dishScore": 9.3,
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "103708656",
            "name": "木瓜苹果思慕雪",
            "thumbnail": "http://i2.chuimg.com/b36b635b00f34e91b7bbd408c9a26c5e_6000w_4000h.jpg?imageView2/2/w/660/interlace/1/q/90",
            "cookId": "10411331",
            "cookName": "Tinrry甜悦",
            "stats": "23160 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "103708650",
            "name": "香煎豆腐(烧烤铁板味)",
            "thumbnail": "https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=2263962881,2041257871&fm=26&gp=0.jpg",
            "cookId": "126334531",
            "cookName": "美丽女神经",
            "stats": "91 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "103708651",
            "name": "轻乳酪蛋糕（低油低糖版）",
            "thumbnail": "https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=2947466538,3540952512&fm=26&gp=0.jpg",
            "cookId": "105784662",
            "cookName": "糯米的厨房",
            "stats": "195 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "103708652",
            "name": "不菠菜鸡蛋饼",
            "thumbnail": "http://i2.chuimg.com/3ad5fcd48a4c11e6a9a10242ac110002_400w_300h.jpg?imageView2/2/w/660/interlace/1/q/90",
            "cookId": "106652802",
            "cookName": "姜诗cc",
            "stats": "3666 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "103708653",
            "name": "【电饭锅】一只番茄饭 番茄拌饭",
            "thumbnail": "http://i1.chuimg.com/a9e101fa8b7311e6a9a10242ac110002_1968w_2624h.jpg@2o_50sh_1pr_1l_235w_138h_1c_1e_90q_1wh",
            "cookId": "112064570",
            "cookName": "李果然",
            "stats": "1806 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "103708654",
            "name": "香烤鸡翅",
            "thumbnail": "http://i1.chuimg.com/022d207fc8fa4d3d8c2e63d617045e15_6000w_4000h.jpg@2o_50sh_1pr_1l_235w_138h_1c_1e_90q_1wh",
            "cookId": "120967814",
            "cookName": "博世家电",
            "stats": "11 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "103708655",
            "name": "新晋网红【杏花楼 咸蛋黄肉松青团】",
            "thumbnail": "http://i2.chuimg.com/28c1c0228a9d11e6a9a10242ac110002_1000w_667h.jpg?imageView2/2/w/660/interlace/1/q/90",
            "cookId": "122079365",
            "cookName": "千寻树",
            "stats": "253 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "103708656",
            "name": "盘丝饼",
            "thumbnail": "http://i2.chuimg.com/b36b635b00f34e91b7bbd408c9a26c5e_6000w_4000h.jpg?imageView2/2/w/660/interlace/1/q/90",
            "cookId": "101553997",
            "cookName": "食肆巷子",
            "stats": "845 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "103708648",
            "name": "『1234糖醋排骨』",
            "thumbnail": "http://i2.chuimg.com/27591c3c296511e7bc9d0242ac110002_1324w_1984h.jpg?imageView2/1/w/235/h/138/interlace/1/q/90",
            "cookId": "107144295",
            "cookName": "o橙小橙o",
            "stats": "179 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "103708649",
            "name": "饭店必点的干锅花菜，是这么做出来的。",
            "thumbnail": "http://i1.chuimg.com/0e8f9a644ab211e7947d0242ac110002_1000w_666h.jpg@2o_50sh_1pr_1l_235w_138h_1c_1e_90q_1wh",
            "cookId": "100351317",
            "cookName": "小美的美食",
            "stats": "314 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "103708650",
            "name": "荷兰宝贝 Dutch Baby",
            "thumbnail": "http://i2.chuimg.com/9d43282c885011e6a9a10242ac110002_1800w_1200h.jpg?imageView2/1/w/235/h/138/interlace/1/q/90",
            "cookId": "10666666",
            "cookName": "阿May又改名儿了",
            "stats": "508 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "103708651",
            "name": "超级绵~奶白吐司",
            "thumbnail": "http://i1.chuimg.com/ff1337128b4911e6a9a10242ac110002_1080w_1080h.jpg@2o_50sh_1pr_1l_660w_90q_1wh",
            "cookId": "10585157",
            "cookName": "啊呜511",
            "stats": "42 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "100232976",
            "name": "《Tinrry下午茶》教你做芒果班戟和芒果千层饼",
            "thumbnail": "http://i2.chuimg.com/6d9419bc883f11e6b87c0242ac110003_578w_420h.jpg?imageView2/1/w/235/h/138/interlace/1/q/90",
            "cookId": "10411331",
            "cookName": "Tinrry甜悦",
            "stats": "23160 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "103699409",
            "name": "蛋糕卷，肉松蛋糕卷，网红贝贝肉松卷",
            "thumbnail": "http://i2.chuimg.com/e58cfcce29f5471d88f62bc75686dc09_1280w_854h.jpg?imageView2/1/w/235/h/138/interlace/1/q/90",
            "cookId": "126334531",
            "cookName": "美丽女神经",
            "stats": "91 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "102276846",
            "name": "自制肉松小贝",
            "thumbnail": "http://i2.chuimg.com/d8e9d0522f4311e7bc9d0242ac110002_1620w_1080h.jpg?imageView2/1/w/235/h/138/interlace/1/q/90",
            "cookId": "105784662",
            "cookName": "糯米的厨房",
            "stats": "195 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        },
        {
            "id": "101814068",
            "name": "不回缩杯子蛋糕cupcake",
            "thumbnail": "http://i2.chuimg.com/74fab86c8afd11e6b87c0242ac110003_640w_643h.jpg?imageView2/1/w/235/h/138/interlace/1/q/90",
            "cookId": "106652802",
            "cookName": "姜诗cc",
            "stats": "3666 做过",
            "dishScore": 9.3,
            "dishStuff": "猪肉,番茄,米饭,电饭锅",
            "img": {
                "img1": "https://f11.baidu.com/it/u=2412046451,2510446191&fm=72",
                "img2": "https://f10.baidu.com/it/u=1804859082,1915308051&fm=72",
                "img3": "http://img1.imgtn.bdimg.com/it/u=2740864456,3377969389&fm=26&gp=0.jpg"
            },
            "title": "#24小时流行作品#",
            "des": "每张照片都有自己的故事"
        }
    ];
    res.success(result);
}

exports.rising = function (req, res) {
    const Recipe = req.models.recipe;
    Recipe.find(['look_count', 'Z'], 10, (err, recipes) => {
        if (err) {
            res.error(500, '数据库出错，' + err);
            return;
        }

        res.success(recipes);
    });
}

/**
 * 创建菜谱
 */
exports.create = function (req, res) {
    const name = req.body.name;
    const cover = req.body.cover;
    const description = req.body.description;
    const steps = req.body.steps;
    const userId = req.decoded.userId;

    if (!name) {
        res.error(500, '菜谱名称不能为空');
        return;
    }
    if (!cover) {
        res.error(500, '菜谱封面图不能为空');
        return;
    }
    if (!description) {
        res.error(500, '菜谱描述不能为空');
        return;
    }
    if (!steps || steps.length == 0) {
        res.error(500, '菜谱步骤不能为空');
        return;
    }

    const Recipe = req.models.recipe;
    Recipe.create({
        user_id: userId,
        name: name,
        cover: cover,
        description: description,
        created_at: new Date().getTime()
    }, (err, recipe) => {
        if (err) {
            res.error(500, '数据库出错，' + err);
            return;
        }

        const RecipeStep = req.models.recipeStep;
        RecipeStep.create(steps.map(step => {
            return {
                recipe_id: recipe.id,
                description: step.description,
                pic_url: step.picUrl,
                order: step.order,
                created_at: new Date().getTime()
            }
        }), function (err, steps) {
            if (err) {
                res.error(500, '数据库出错，' + err);
                return;
            }

            res.success({
                ...recipe,
                steps: steps || []
            });
        });
    });
}

exports.detail = function (req, res) {
    const id = req.query.id;
    console.log(id);
    if (!id) {
        res.error(500, '菜谱ID不能为空');
        return;
    }

    const Recipe = req.models.recipe;
    Recipe.find({ id }, (err, recipes) => {
        if (err) {
            res.error(500, '数据库出错，' + err);
            return;
        }

        const recipe = recipes && recipes[0];
        if (!recipe) {
            res.error(500, '未找到该菜谱');
            return;
        }

        const RecipeStep = req.models.recipeStep;
        RecipeStep.find({ recipe_id: recipe.id }, (err, steps) => {
            if (err) {
                res.error(500, '数据库出错，' + err);
                return;
            }

            recipe.look_count = recipe.look_count + 1;
            recipe.save(function (err) {
                if (err) {
                    res.error(500, '数据库出错，' + err);
                    return;
                }

                res.success({
                    ...recipe,
                    steps: steps || []
                });
            });
        })
    });
}


exports.selfrecipe = function (req, res) {
    const id = req.query.id;
    const userId = req.decoded.userId;
    console.log(id);

    const Recipe = req.models.recipe;
    Recipe.find({ user_id: userId }, (err, recipes) => {
        if (err) {
            res.error(500, '数据库出错，' + err);
            return;
        }

        res.success({ recipes });
    });
}

//创建收藏
exports.collection = function (req, res) {
    const id = req.query.id;
    console.log(id);
    const name = req.query.name;
    const cover = req.query.cover;
    const collectionMenu = req.query.collectionMenu;
    const collectionDerection = req.query.collectionDerection;
    if (!id) {
        res.error(500, 'id不能为空');
        return;
    }
    if (!name) {
        res.error(500, '菜谱名称不能为空');
        return;
    }
    if (!cover) {
        res.error(500, '菜谱封面图不能为空');
        return;
    }
    if (!collectionMenu) {
        res.error(500, '菜谱封面图不能为空');
        return;
    }
    if (!collectionDerection) {
        res.error(500, '菜谱封面图不能为空');
        return;
    }

    const recipeCollection = req.models.recipeCollection;
    recipeCollection.create({
        id: id,
        name: name,
        cover: cover,
        menu: collectionMenu,
        derection: collectionDerection,
    }, (err, recipeCollection) => {
        if (err) {
            res.error(500, '数据库出错，' + err);
            return;
        }
        res.success(recipeCollection);
    });
}

// 获取收藏
exports.getcollection = function (req, res) {
    const recipeCollection = req.models.recipeCollection;
    recipeCollection.find((err, recipeCollection) => {
        if (err) {
            res.error(500, '数据库出错，' + err);
            return;
        }
        res.success(recipeCollection);
    });
}